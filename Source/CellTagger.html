<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CellTagger &mdash; chombo-discharge  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../_static/my_theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spatial discretization" href="SpatialDiscretization.html" />
    <link rel="prev" title="AmrMesh" href="AmrMesh.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            chombo-discharge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Base/Documentation.html">Using this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Control.html">Controlling <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Testing.html">Code testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Acknowledgements.html">Acknowledgements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="DesignOverview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Driver.html">Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="ComputationalGeometry.html">ComputationalGeometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeStepper.html">TimeStepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrMesh.html">AmrMesh</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CellTagger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#implementing-a-new-celltagger">Implementing a new <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#regrid">regrid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tagcells">tagCells</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parseoptions">parseOptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plot-data">Plot data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#manual-refinement-and-restriction">Manual refinement and restriction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-buffer">Adding a buffer</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Discretization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="SpatialDiscretization.html">Spatial discretization</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChomboBasics.html"><code class="docutils literal notranslate"><span class="pre">Chombo-3</span></code> basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="MeshData.html">Mesh data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Realm.html">Realm</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinearSolvers.html">Linear solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="VV.html">Verification and validation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Solvers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/CDR.html">Convection-Diffusion-Reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/Electrostatics.html">Electrostatic solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/Ito.html">Îto diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/KineticMonteCarlo.html">Kinetic Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/MeshODESolver.html">Mesh ODE solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/RTE.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/SurfaceODESolver.html">Surface ODE solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/TracerParticles.html">Tracer particles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multi-physics applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Applications/CdrPlasmaModel.html">CDR plasma model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/DischargeInceptionModel.html">Discharge inception model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/ItoKMC.html">Îto-KMC plasma model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Single-solver applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Applications/AdvectionDiffusionModel.html">Advection-diffusion model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/BrownianWalkerModel.html">Brownian walker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/ElectrostaticsModel.html">Electrostatics model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/GeometryModel.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/MeshODEModel.html">Mesh ODE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/RadiativeTransferModel.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/TracerParticleModel.html">Tracer particle model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/DataParser.html">Data parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/LookupTable.html">LookupTable1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/RandomNumbers.html">Random numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/LeastSquares.html">Least squares</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Contrib/Contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contrib/CodeStandard.html">Code standard</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ZZReferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">chombo-discharge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CellTagger</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Source/CellTagger.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="celltagger">
<span id="chap-celltagger"></span><h1>CellTagger<a class="headerlink" href="#celltagger" title="Permalink to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> class is responsible for flagging grid cells for refinement or coarsening, and is thus the main class that determines what the grids look like.
By default, <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> does not actually flag anything for refinement, so if the user wants to implement a new refinement or coarsening routine, one must do so by writing a new derived class from <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code>.
The <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> parent class is a stand-alone class - it does not have a view of <a class="reference internal" href="AmrMesh.html#chap-amrmesh"><span class="std std-ref">AmrMesh</span></a>, <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">Driver</span></a>, or <a class="reference internal" href="TimeStepper.html#chap-timestepper"><span class="std std-ref">TimeStepper</span></a> and the user is responsible for providing <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> with these dependencies.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Here is the <a class="reference external" href="https://chombo-discharge.github.io/chombo-discharge/doxygen/html/classCellTagger.html">CellTagger C++ API</a></p>
</div>
<p>Refinement flags live in a data holder called <code class="docutils literal notranslate"><span class="pre">EBAMRTags</span></code>, which is a typedef:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">RefCountedPtr</span><span class="o">&lt;</span><span class="n">LayoutData</span><span class="o">&lt;</span><span class="n">DenseIntVectSet</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">EBAMRTags</span><span class="p">;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="ChomboBasics.html#chap-basics"><span class="std std-ref">Chombo-3 basics</span></a> for an explanation of how the individual templates.
Briefly, the outer vector in <code class="docutils literal notranslate"><span class="pre">EBAMRTags</span></code> indicates the grid level, whereas <code class="docutils literal notranslate"><span class="pre">LayoutData</span></code> is a data holder on each grid level and indexes the grid patches.
That is, <code class="docutils literal notranslate"><span class="pre">LayoutData&lt;DenseIntVectSet</span></code> is a distribution of <code class="docutils literal notranslate"><span class="pre">DenseIntVectSet</span></code> on a level, whereas <code class="docutils literal notranslate"><span class="pre">DenseIntVectSet</span></code> is a data holder that stores the refinement flags on a grid patch.
For performance reasons, <code class="docutils literal notranslate"><span class="pre">DenseIntVectSet</span></code> onlys store refinement cells on a per-patch basis.
It is not possible to add a grid cell to a <code class="docutils literal notranslate"><span class="pre">DenseIntVectSet</span></code> if it falls outside the grid patch.
Note that <code class="docutils literal notranslate"><span class="pre">EBAMRTags</span></code> is <em>not</em> set up for communication, and so it is not possible to fill ghost cells regions from other patches.
The refinement flags themselves are owned by <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">Driver</span></a>, and are used to generate new grids that cover all the cell tags.</p>
<p>A part of the current C++ header file for <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> is included below, where we highlight the functions that must be implemented in order to create a new refinement method.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<span id="celltaggerpurefunctions"></span><div class="code-block-caption"><span class="caption-number">Listing 22 </span><span class="caption-text">Header file for <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code>.</span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm">  @brief Regrid function for cell tagger (in case it uses transient storage to do things)</span>
<span class="cm">  @details This function exists because implementations may require data to be allocated on a mesh. This function is</span>
<span class="cm">  called by Driver to make sure data is reallocated when it needs to. </span>
<span class="cm">*/</span>
<span class="hll"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
</span><span class="hll"><span class="nf">regrid</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span>
<span class="cm">/*!</span>
<span class="cm">  @brief Parse class options.</span>
<span class="cm">  @note This function is called by Driver. </span>
<span class="cm">*/</span>
<span class="hll"><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
</span><span class="hll"><span class="nf">parseOptions</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span>
<span class="cm">/*!</span>
<span class="cm">  @brief Tag cells</span>
<span class="cm">  @param[inout] a_tags Tags on grid levels</span>
<span class="cm">  @details EBAMRTags is a data-type Vector&lt;RefCountedPtr&lt;LayoutData&lt;DenseIntVectSet&gt; &gt; &gt;. The vector indicates the grid level, the LayoutData indicates data ownership (in</span>
<span class="cm">  much the same way as LevelData. The DenseIntVectSet is essentially an IntVectSet restricted to the patch (i.e. one cannot add IntVects that are outside the patch). </span>
<span class="cm">  This function cells for refinement or coarsening. The user&#39;s responsibility is to add (or remove) tags from a_tags. </span>
<span class="hll"><span class="cm">*/</span>
</span><span class="hll"><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span>
</span><span class="nf">tagCells</span><span class="p">(</span><span class="n">EBAMRTags</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a_tags</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div>
<section id="implementing-a-new-celltagger">
<h2>Implementing a new <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code><a class="headerlink" href="#implementing-a-new-celltagger" title="Permalink to this heading"></a></h2>
<p>To implement a new <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code>, the pure functions listed in <a class="reference internal" href="#celltaggerpurefunctions"><span class="std std-numref">Listing 22</span></a> must be implemented.
Below, we discuss these in turn:</p>
<section id="regrid">
<h3>regrid<a class="headerlink" href="#regrid" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">regrid</span></code> is called by <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">Driver</span></a> during regrids.
The existence of this routine is due to the common usage pattern where <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> holds some auxiliary mesh (or particle) data that is used when evaluating refinement and coarsening criteria.
This routine should reallocate this  storage during regrids.</p>
</section>
<section id="tagcells">
<h3>tagCells<a class="headerlink" href="#tagcells" title="Permalink to this heading"></a></h3>
<p>When the regrid routine enters, the <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> will be asked to generate the refinement flags through the <code class="docutils literal notranslate"><span class="pre">tagCells</span></code> function in <a class="reference internal" href="#celltaggerpurefunctions"><span class="std std-numref">Listing 22</span></a>.
This routine should add cells that will be refined, and remove cells that will be coarsened.
The return value of this function is a boolean that should return <code class="docutils literal notranslate"><span class="pre">false</span></code> if no new tags were found.
While it is possible to skip this test, we note that returning <code class="docutils literal notranslate"><span class="pre">true</span></code> also when no new refinement regions were found will trigger a full regrid.</p>
</section>
<section id="parseoptions">
<h3>parseOptions<a class="headerlink" href="#parseoptions" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">parseOptions</span></code> is called by <a class="reference internal" href="Driver.html#chap-driver"><span class="std std-ref">Driver</span></a> when setting the <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code>.
This routine should parse options into the <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> subclass.
Note that it is also useful to overwrite the function <code class="docutils literal notranslate"><span class="pre">parseRuntimeOptions</span></code> if one needs run-time configuration of the refinement criteria.</p>
</section>
<section id="plot-data">
<h3>Plot data<a class="headerlink" href="#plot-data" title="Permalink to this heading"></a></h3>
<p>It is also possible to have <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> write data to plot files, and the interface for this is identical to the plot file interface in <a class="reference internal" href="TimeStepper.html#chap-timestepper"><span class="std std-ref">TimeStepper</span></a>.
The three functions below must then be implemented:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Get number of plot variables that will be written to file (by Driver).</span>
<span class="cm">    @return Returns number of plot variables that Driver will write to plot files. </span>
<span class="cm">  */</span>
<span class="hll"><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span>
</span><span class="hll"><span class="w">  </span><span class="nf">getNumberOfPlotVariables</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Get plot variable names. </span>
<span class="cm">  */</span>
<span class="hll"><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class="hll"><span class="w">  </span><span class="n">getPlotVariableNames</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Write plot data.</span>
<span class="cm">    @param[inout] a_output Output data holder</span>
<span class="cm">    @param[inout] a_icomp Starting variable in a_output where we begin appending data.</span>
<span class="cm">    @param[in] a_outputRealm Realm where a_output belongs</span>
<span class="cm">    @param[in] a_level Grid level</span>
<span class="cm">  */</span>
<span class="hll"><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
</span><span class="hll"><span class="w">  </span><span class="nf">writePlotData</span><span class="p">(</span><span class="n">LevelData</span><span class="o">&lt;</span><span class="n">EBCellFAB</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_output</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a_icomp</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">a_outputRealm</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a_level</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</span></pre></div>
</div>
<p>The interpretation of these functions is exactly the same as for <a class="reference internal" href="TimeStepper.html#chap-timestepper"><span class="std std-ref">TimeStepper</span></a>, and we refer to the <a class="reference internal" href="TimeStepper.html#chap-timestepper"><span class="std std-ref">TimeStepper</span></a> documentation for a detailed explanation.</p>
</section>
</section>
<section id="manual-refinement-and-restriction">
<h2>Manual refinement and restriction<a class="headerlink" href="#manual-refinement-and-restriction" title="Permalink to this heading"></a></h2>
<p>The user can add manual refinement by specifying Cartesian spatial regions to be refined down to some grid level, by specifying the physical corners and the refinement level.
The input parameters in this case are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num_ref_boxes</span></code> for specifying how many such boxes will be parsed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_box&lt;num&gt;_lo</span></code> and <code class="docutils literal notranslate"><span class="pre">ref_box&lt;num&gt;_hi</span></code> that determine the Cartesian region to be refined.
Here, <code class="docutils literal notranslate"><span class="pre">&lt;num&gt;</span></code> is a placeholder for an integer.
If the user specifies <code class="docutils literal notranslate"><span class="pre">num_ref_boxes</span> <span class="pre">=</span> <span class="pre">2</span></code>, then <code class="docutils literal notranslate"><span class="pre">ref_box1_lo</span></code>, <code class="docutils literal notranslate"><span class="pre">ref_box1_hi</span></code>, <code class="docutils literal notranslate"><span class="pre">ref_box2_lo</span></code>, and <code class="docutils literal notranslate"><span class="pre">ref_box2_hi</span></code> must all be defined.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_box&lt;num&gt;_lvl</span></code>, which specifies the refinement depth corresponding to box <code class="docutils literal notranslate"><span class="pre">&lt;num&gt;</span></code>.</p></li>
</ul>
<p>An example of the manual refinement syntax is given in <a class="reference internal" href="#celltaggeroptions"><span class="std std-numref">Listing 23</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<span id="celltaggeroptions"></span><div class="code-block-caption"><span class="caption-number">Listing 23 </span><span class="caption-text">Default class options for <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code>, including the manual refinement syntax and buffer region definition.</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># ====================================================================================================
# CellTagger class options
# ====================================================================================================
CellTagger.buffer     = 0    ## Grow tagged cells

CellTagger.num_tag_boxes     = 0              ## Number of allowed tag boxes (0 = tags allowe everywhere)
CellTagger.tag_box1_lo       = 0.0 0.0 0.0    ## Only allow tags that fall between
CellTagger.tag_box1_hi       = 0.0 0.0 0.0    ## these two corners

CellTagger.num_ref_boxes     = 0              ## Number of specified refinement boxes
CellTagger.ref_box1_lo       = 0.0 0.0 0.0    ## Refine region between
CellTagger.ref_box1_hi       = 0.0 0.0 0.0    ## these two corners.
CellTagger.ref_box1_lvl      = 0              ## Refine to this level.
</pre></div>
</div>
</div>
<p>It is possible to prevent <code class="docutils literal notranslate"><span class="pre">CellTagger</span></code> from adding refinement flags in specified regions by specifying <code class="docutils literal notranslate"><span class="pre">num_tag_boxes</span></code>.
The default behavior is to add a number of boxes where refinement and coarsening is allowed, and prevent tags from being generated outside of these regions.
If no boxes are defined, tagging is allowed everywhere.
The syntax is the same as for <code class="docutils literal notranslate"><span class="pre">num_ref_boxes</span></code>, e.g., one must define <code class="docutils literal notranslate"><span class="pre">tag_box&lt;num&gt;_lo</span></code> and <code class="docutils literal notranslate"><span class="pre">tag_box&lt;num&gt;_hi</span></code>.
By adding restrictive boxes, tagging will only be allowed inside the specified box corners <code class="docutils literal notranslate"><span class="pre">tag_box1_lo</span></code> and <code class="docutils literal notranslate"><span class="pre">tag_box1_hi</span></code>.
More boxes can be specified by following the same convention, e.g., <code class="docutils literal notranslate"><span class="pre">tag_box2_lo</span></code> and <code class="docutils literal notranslate"><span class="pre">tag_box2_hi</span></code>.</p>
</section>
<section id="adding-a-buffer">
<h2>Adding a buffer<a class="headerlink" href="#adding-a-buffer" title="Permalink to this heading"></a></h2>
<p>By default, each MPI rank can only tag grid cells where it owns data, which has has been enforced due to performance and communication reasons.
Under the hood, the <code class="docutils literal notranslate"><span class="pre">DenseIntVectSet</span></code> is an array of boolean values on a patch which is very fast and simple to communicate with MPI.
Adding a grid cell for refinement which lies outside the patch will lead to memory corruptions.
Frequently, however, it is necessary to add <em>buffer regions</em> to ensure that an area-of-interest around the tagged region is also refined.
This is done by growing the final generated tags by specifying the <code class="docutils literal notranslate"><span class="pre">buffer</span></code>.
The syntax for this is given in <a class="reference internal" href="#celltaggeroptions"><span class="std std-numref">Listing 23</span></a>.
Just before passing the flags into <code class="docutils literal notranslate"><span class="pre">AmrMesh</span></code> grid generation routines, the tagged cells are put into a different data holder (<code class="docutils literal notranslate"><span class="pre">IntVectSet</span></code>), and this data holder <em>can</em> contain cells that are outside the patch boundaries.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AmrMesh.html" class="btn btn-neutral float-left" title="AmrMesh" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SpatialDiscretization.html" class="btn btn-neutral float-right" title="Spatial discretization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SINTEF Energy Research.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>