<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discharge inception model &mdash; chombo-discharge  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../_static/my_theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Îto-KMC plasma model" href="ItoKMC.html" />
    <link rel="prev" title="CDR plasma model" href="CdrPlasmaModel.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            chombo-discharge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Base/Documentation.html">Using this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Control.html">Controlling <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Testing.html">Code testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Base/Acknowledgements.html">Acknowledgements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Source/DesignOverview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Driver.html">Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/ComputationalGeometry.html">ComputationalGeometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/TimeStepper.html">TimeStepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/AmrMesh.html">AmrMesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/CellTagger.html">CellTagger</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Discretization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Source/SpatialDiscretization.html">Spatial discretization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/ChomboBasics.html"><code class="docutils literal notranslate"><span class="pre">Chombo-3</span></code> basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/MeshData.html">Mesh data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Particles.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Realm.html">Realm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/LinearSolvers.html">Linear solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/VV.html">Verification and validation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Solvers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/CDR.html">Convection-Diffusion-Reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/Electrostatics.html">Electrostatic solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/Ito.html">Îto diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/KineticMonteCarlo.html">Kinetic Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/MeshODESolver.html">Mesh ODE solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/RTE.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/SurfaceODESolver.html">Surface ODE solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/TracerParticles.html">Tracer particles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multi-physics applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="CdrPlasmaModel.html">CDR plasma model</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Discharge inception model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#townsend-criterion">Townsend criterion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stationary-mode">Stationary mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transient-mode">Transient mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#negative-ion-transport">Negative ion transport</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inception-probability">Inception probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statistical-time-lag">Statistical time lag</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#input-data">Input data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#algorithms">Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#field-solve">Field solve</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inception-integral">Inception integral</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#euler">Euler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trapezoidal">Trapezoidal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-size-selection">Step size selection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#critical-volume">Critical volume</a></li>
<li class="toctree-l3"><a class="reference internal" href="#critical-surface">Critical surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inception-voltage">Inception voltage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#streamer-inception">Streamer inception</a></li>
<li class="toctree-l4"><a class="reference internal" href="#townsend-inception">Townsend inception</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minimum-inception-voltage">Minimum inception voltage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Inception probability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advection-algorithm">Advection algorithm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adaptive-mesh-refinement">Adaptive mesh refinement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solver-configuration">Solver configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-a-new-problem">Setting up a new problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-programs">Example programs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#high-voltage-vessel">High-voltage vessel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#electrode-with-surface-roughness">Electrode with surface roughness</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Electrode with surface roughness</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ItoKMC.html">Îto-KMC plasma model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Single-solver applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AdvectionDiffusionModel.html">Advection-diffusion model</a></li>
<li class="toctree-l1"><a class="reference internal" href="BrownianWalkerModel.html">Brownian walker</a></li>
<li class="toctree-l1"><a class="reference internal" href="ElectrostaticsModel.html">Electrostatics model</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeometryModel.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="MeshODEModel.html">Mesh ODE</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadiativeTransferModel.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TracerParticleModel.html">Tracer particle model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/DataParser.html">Data parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/LookupTable.html">LookupTable1D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/RandomNumbers.html">Random numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/LeastSquares.html">Least squares</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Contrib/Contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contrib/CodeStandard.html">Code standard</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ZZReferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">chombo-discharge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Discharge inception model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Applications/DischargeInceptionModel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="discharge-inception-model">
<span id="chap-dischargeinceptionmodel"></span><h1>Discharge inception model<a class="headerlink" href="#discharge-inception-model" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The discharge inception model computes the inception voltage and probability of discharge inception for arbitrary geometries and voltage forms.
For estimating the streamer inception, the module resolves the electron avalanche integral</p>
<div class="math notranslate nohighlight" id="equation-k-integral">
<span class="eqno">(14)<a class="headerlink" href="#equation-k-integral" title="Permalink to this equation"></a></span>\[K\left(\mathbf{x}\right) = \int_{\mathbf{x}}^{\text{until }\alpha_{\text{eff}} \leq 0} \alpha_{\text{eff}}(E,\mathbf{x}^\prime)\text{d}l\]</div>
<p>where <span class="math notranslate nohighlight">\(E = |\mathbf{E}|\)</span> and where <span class="math notranslate nohighlight">\(\alpha_{\text{eff}}(E,\mathbf{x}) = \alpha(E,\mathbf{x}) - \eta(E,\mathbf{x})\)</span> is the effective ionization coefficient.
The integration runs along electric field lines.</p>
<p>The discharge inception model solves for <span class="math notranslate nohighlight">\(K = K\left(\mathbf{x}\right)\)</span> for all <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>, i.e., the inception integral is evaluated for all starting positions of the first electron.
This differs from the conventional approach where the user will first extract electric field lines for post-processing.
Note that <span class="math notranslate nohighlight">\(K\left(\mathbf{x}\right) = K(\mathbf{x}; U)\)</span> where <span class="math notranslate nohighlight">\(U\)</span> is the applied voltage.</p>
<p>In addition to the above, the user can specify a critical threshold value for <span class="math notranslate nohighlight">\(K_c\)</span> which is used for computing</p>
<ul class="simple">
<li><p>The <em>critical volume</em> <span class="math notranslate nohighlight">\(V_c = \int_{K\geq K_c} \textrm{d}V\)</span>.</p></li>
<li><p>The inception voltage <span class="math notranslate nohighlight">\(U_c\)</span>.</p></li>
<li><p>The probability of having the first electron in the critical volume, <span class="math notranslate nohighlight">\(dP(t,t+\Delta t)\)</span>.</p></li>
</ul>
<p>The discharge inception model is implemented through the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DischargeInceptionStepper</span></code>, which implements <a class="reference internal" href="../Source/TimeStepper.html#chap-timestepper"><span class="std std-ref">TimeStepper</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DischargeInceptionTagger</span></code>, which implements <a class="reference internal" href="../Source/CellTagger.html#chap-celltagger"><span class="std std-ref">CellTagger</span></a> and flags cells for refinement and coarsening.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DischargeInceptionSpecies</span></code>, which implements <a class="reference internal" href="../Solvers/CDR.html#chap-cdrspecies"><span class="std std-ref">CdrSpecies</span></a> for the negative ion transport description.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The source code for the discharge inception model is given in <code class="file docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Physics/DischargeInception</span></code>.
See <a class="reference external" href="https://chombo-discharge.github.io/chombo-discharge/doxygen/html/classPhysics_1_1DischargeInception_1_1DischargeInceptionStepper.html">DischargeInceptionStepper</a> for the C++ API for this time stepper.</p>
</div>
<section id="townsend-criterion">
<h3>Townsend criterion<a class="headerlink" href="#townsend-criterion" title="Permalink to this heading"></a></h3>
<p>One may also solve for the Townsend inception criterion, which is formulated as follows:</p>
<div class="math notranslate nohighlight">
\[T\left(\mathbf{x}\right) = \gamma\left(\exp\left[K\left(\mathbf{x}\right)\right]-1\right) \geq 1.\]</div>
<p>The interpretation of this criterion is that each starting electron produces <span class="math notranslate nohighlight">\(\exp\left[K\left(\mathbf{x}\right)\right]-1\)</span> secondary electron-ion pairs.
The residual ions will drift towards cathode surfaces and generate secondary ionization with a user-supplied efficiency <span class="math notranslate nohighlight">\(\gamma=\gamma\left(E,\mathbf{x}\right)\)</span>.</p>
<p>The discharge inception model can be run in two modes:</p>
<ul class="simple">
<li><p>A stationary mode, where one only calculations <span class="math notranslate nohighlight">\(K\left(\mathbf{x}\right)\)</span> for a range of voltages, see <a class="reference internal" href="#chap-stationarymode"><span class="std std-ref">Stationary mode</span></a>.</p></li>
<li><p>In transient mode, where <span class="math notranslate nohighlight">\(K\left(\mathbf{x}\right)\)</span> is computed dynamically according to a user-supplied voltage shape.
This mode can also be used to evaluate the inception probability for a given voltage curve, see <a class="reference internal" href="#chap-transientmode"><span class="std std-ref">Transient mode</span></a>.</p></li>
</ul>
</section>
<section id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading"></a></h3>
<p>The discharge inception model is implemented in <code class="file docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Physics/DischargeInception</span></code> as</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm">  @brief Class for streamer inception integral evaluations. </span>
<span class="cm">  @details P is the tracer particle type</span>
<span class="cm">  F is the field solver type. </span>
<span class="cm">  C is the convection-diffusion-reaction solver type. </span>
<span class="cm">*/</span>
<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TracerParticle</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FieldSolverMultigrid</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CdrCTU</span><span class="o">&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DischargeInceptionStepper</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TimeStepper</span>
</pre></div>
</div>
<p>The template template parameters indicate which types of solvers to used within the compound algorithm.
The template parameters indicate the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">typename</span> <span class="pre">P</span></code> is the tracer particle solver (see <a class="reference internal" href="../Solvers/TracerParticles.html#chap-tracerparticlesolver"><span class="std std-ref">TracerParticleSolver</span></a>) for reconstructing the inception integral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typename</span> <span class="pre">F</span></code> is the field solver (see <a class="reference internal" href="../Solvers/Electrostatics.html#chap-fieldsolver"><span class="std std-ref">FieldSolver</span></a>) that is used when computing the electric field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typename</span> <span class="pre">C</span></code> is the convection diffusion reaction solver (see <a class="reference internal" href="../Solvers/CDR.html#chap-cdrsolver"><span class="std std-ref">CdrSolver</span></a>) to use when resolving negative ion transport.</p></li>
</ul>
</section>
</section>
<section id="stationary-mode">
<span id="chap-stationarymode"></span><h2>Stationary mode<a class="headerlink" href="#stationary-mode" title="Permalink to this heading"></a></h2>
<p>The stationary mode resolves <a class="reference internal" href="#equation-k-integral">Eq. 14</a> for a range of voltages, including both positive and negative polarities.
This procedure occurs through the following steps:</p>
<ol class="arabic simple">
<li><p>Solve for the background field with an applied voltage <span class="math notranslate nohighlight">\(U = 1\)</span> on all live electrodes.</p></li>
<li><p>Obtain the critical field by obtaining the root <span class="math notranslate nohighlight">\(\alpha_{\text{eff}}(E) = 0\)</span>.
This step is performed using Brent’s method.</p></li>
<li><p>Scale the voltage to the lowest voltage that exceeds the critical field.</p></li>
<li><p>Solve for <span class="math notranslate nohighlight">\(K(\mathbf{x})\)</span> from the lowest voltage that exceeds the critical field until a user-specified threshold.
These calculations are performed for both polarities.</p></li>
</ol>
<p>On output, the user is provided with the following:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(K\)</span> values for positive and negative voltages, as well as the Townsend criterion.</p></li>
<li><p>Critical volumes and surfaces.</p></li>
<li><p>Inception voltage, both for streamer inception and Townsend inception, for both polarities.</p></li>
<li><p>The <em>critical position</em>, i.e., the position corresponding to <span class="math notranslate nohighlight">\(K(\mathbf{x})\)</span>.</p></li>
</ul>
</section>
<section id="transient-mode">
<span id="chap-transientmode"></span><h2>Transient mode<a class="headerlink" href="#transient-mode" title="Permalink to this heading"></a></h2>
<p>In transient mode the user can apply a voltage curve <span class="math notranslate nohighlight">\(U = U(t)\)</span> reconstruct the <span class="math notranslate nohighlight">\(K\)</span> value at each time step, and recompute the critical volume so that we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}K &amp;= K(\mathbf{x}, t) \\
T &amp;= T(\mathbf{x}, t) \\
V_c &amp;= V_c(t).\end{split}\]</div>
<p>The rationale for computing the above quantities is that one may describe the availability of negative ions within the critical volumes by augmenting the model with an ion transport description.
Furthermore, if one also has a description of the electron detachment rate, one may then evaluate the probability that an electron detaches from a negative ion inside of the critical region.</p>
<section id="negative-ion-transport">
<h3>Negative ion transport<a class="headerlink" href="#negative-ion-transport" title="Permalink to this heading"></a></h3>
<p>We also assume that ions move as drifting Brownian walkers in the electric field (see <a class="reference internal" href="../Solvers/Ito.html#chap-itodiffusion"><span class="std std-ref">Îto diffusion</span></a>).
This can be written in the fluctuating hydrodynamics limit as an evolution equation for the ion density</p>
<div class="math notranslate nohighlight">
\[\frac{\partial n_-}{\partial t} = -\nabla\cdot\left(\mathbf{v} n_-\right) + \nabla\cdot\left(D\nabla  n_-\right) + \sqrt{2D n_-}\mathbf{Z},\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{Z}\)</span> represents uncorrelated Gaussian white noise.
Note that the above equation is a mere rewrite of the Ito process for a collection of particles; it is not really useful per se since it is a tautology for the original Ito process.</p>
<p>However, we are interested in the average ion distribution over many experiments, so by taking the ensemble average we obtain a regular advection-diffusion equation for the evolution of the negative ion distribution <span class="math notranslate nohighlight">\(\langle n_-\rangle\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \langle n_-\rangle}{\partial t} = -\nabla\cdot\left(\mathbf{v} \langle n_-\rangle\right) + \nabla\cdot\left(D\nabla \langle n_-\rangle\right).\]</div>
<p>This equation is sensible only when <span class="math notranslate nohighlight">\(\langle n_-\rangle\)</span> is interpreted as an ion density distribution (over many identical experiments).</p>
</section>
<section id="inception-probability">
<h3>Inception probability<a class="headerlink" href="#inception-probability" title="Permalink to this heading"></a></h3>
<p>The probability of discharge inception in a time interval <span class="math notranslate nohighlight">\([t,t+\text{d}t]\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[\text{d}P(t) = \left[1-P\left(t\right)\right]\lambda(t) \text{d}t,\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda(t)\)</span> is a placeholder for the electron generation rate within the critical volume.
The exact solution for <span class="math notranslate nohighlight">\(P(t)\)</span> is</p>
<div class="math notranslate nohighlight">
\[P(t) = 1 - \exp\left(-\int_{-\infty}^t \lambda\left(t^\prime\right)\text{d}t^\prime\right).\]</div>
<p>An expression for the electron generation rate can be given by</p>
<div class="math notranslate nohighlight">
\[\lambda(t) = \int_{V_c(t)}\left\langle\frac{\partial n_e}{\partial t}\right\rangle\left(1 - \frac{\eta}{\alpha}\right)\text{d}V + \int_{A_c(t)}\frac{\left\langle j_e\right\rangle}{e}\left(1-\frac{\eta}{\alpha}\right)\text{d} A,\]</div>
<p>Inserting the expression for <span class="math notranslate nohighlight">\(\lambda\)</span> and integrating for <span class="math notranslate nohighlight">\(P(t)\)</span> yields</p>
<div class="math notranslate nohighlight" id="equation-dischargeinceptionprobability">
<span class="eqno">(15)<a class="headerlink" href="#equation-dischargeinceptionprobability" title="Permalink to this equation"></a></span>\[P(t) = 1  - \exp\left[-\int_0^t\left(\int_{V_c(t^\prime)}\left\langle\frac{dn_{\text{e}}}{dt^\prime}\right\rangle\left(1-\frac{\eta}{\alpha}\right) \text{d}V + \int_{A_c(t^\prime)}\frac{j_e}{q_{\text{e}}}\left(1-\frac{\eta}{\alpha}\right) \text{d}A\right)\text{d}t^\prime\right].\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\left\langle\frac{d n_{\text{e}}}{dt}\right\rangle\)</span> is the electron production rate from both background ionization and electron detachment, i.e.</p>
<div class="math notranslate nohighlight">
\[\left\langle\frac{d n_{\text{e}}}{dt}\right\rangle = S_{\text{bg}} + k_d \left\langle n_-\right\rangle,\]</div>
<p>where <span class="math notranslate nohighlight">\(S_{\text{bg}}\)</span> is the background ionization rate set by the user, <span class="math notranslate nohighlight">\(k_d\)</span> is the negative ion detachment rate, and <span class="math notranslate nohighlight">\(\left\langle n_-\right\rangle\)</span> is the negative ion distribution.
The second integral is due to electron emission from the cathode and into the critical volume.
Note that, internally, we always ensure that <span class="math notranslate nohighlight">\(j_{\text{e}} dA\)</span> evaluates to zero on anode surfaces.</p>
</section>
<section id="statistical-time-lag">
<h3>Statistical time lag<a class="headerlink" href="#statistical-time-lag" title="Permalink to this heading"></a></h3>
<p>We also compute the probability of a first electron appearing in the time interval <span class="math notranslate nohighlight">\([t, t+\Delta t]\)</span>, given by</p>
<div class="math notranslate nohighlight" id="equation-dischargeinceptionprobability2">
<span class="eqno">(16)<a class="headerlink" href="#equation-dischargeinceptionprobability2" title="Permalink to this equation"></a></span>\[\Delta P(t, t+\Delta t) = \left[1-P(t)\right] \left(\int_{V_c(t^\prime)}\left\langle\frac{dn_{\text{e}}}{dt^\prime}\right\rangle\left(1-\frac{\eta}{\alpha}\right) \text{d}V + \int_{A_c(t^\prime)}\frac{j_e}{q_{\text{e}}}\left(1-\frac{\eta}{\alpha}\right) \text{d}A\right)\Delta t\]</div>
<p>When running in transient mode the user must set the voltage curve, and pay particular caution to setting the initial ion density, mobility, and detachment rates.</p>
<p>The statistical time lag, or average waiting time for the first electron, is available from the computed data, and is given by integrating <span class="math notranslate nohighlight">\(t \text{d}P\)</span>, which yields</p>
<div class="math notranslate nohighlight">
\[\tau = \frac{1}{P(t)}\int_0^\infty t\left[1-P(t)\right]\lambda(t)\text{d}t.\]</div>
<p>Other derived values (such as the standard deviation of the waiting time) is also available, and can be calculated from the <span class="math notranslate nohighlight">\(P(t)\)</span> and <span class="math notranslate nohighlight">\(\lambda(t)\)</span> similar to the procedure above.
Numerically, this is calculated using the trapezoidal rule.</p>
</section>
</section>
<section id="input-data">
<span id="chap-dischargeinceptioninputdata"></span><h2>Input data<a class="headerlink" href="#input-data" title="Permalink to this heading"></a></h2>
<p>The input to the discharge inception model are:</p>
<ol class="arabic simple">
<li><p>Streamer inception threshold.</p></li>
<li><p>Townsend ionization and attachment coefficient.</p></li>
<li><p>Background ionization rate (e.g., from cosmic radiation).</p></li>
<li><p>Electron detachment rate from negative ions.</p></li>
<li><p>Negative ion mobility and diffusion coefficients.</p></li>
<li><p>Initial negative ion density.</p></li>
<li><p>Secondary emission coefficients.</p></li>
<li><p>Voltage curve (for transient simulations).</p></li>
<li><p>Space and surface charge if resolving a space-charge influenced field.</p></li>
</ol>
<p>The input data to the discharge inception model is done by passing in C++-functions to the class.
These functions are mainly in the forms of an <code class="docutils literal notranslate"><span class="pre">std::function</span></code>, so the user can pass in function pointers or lambdas for configuring the behavior of the model.
The relevant user API for setting the above variables are listed below.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the voltage curve (used for transient mode)</span>
<span class="cm">    @param[in] a_voltageCurve Voltage curve</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setVoltageCurve</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a_time</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_voltageCurve</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set space charge distribution</span>
<span class="cm">    @param[in] a_rho Space charge distribution</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setRho</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_rho</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set surface charge distribution</span>
<span class="cm">    @param[in] a_sigma Surface charge distribution</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setSigma</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_sigma</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the negative ion density</span>
<span class="cm">    @param[in] a_density Negative ion density</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setIonDensity</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_density</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the negative ion mobility (field-dependent)</span>
<span class="cm">    @param[in] a_mobility Negative ion  mobility</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setIonMobility</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="w"> </span><span class="n">E</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_mobility</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the negative ion diffusion coefficient (field-dependent)</span>
<span class="cm">    @param[in] a_diffCo Negative ion diffusion coefficient</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setIonDiffusion</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="w"> </span><span class="n">E</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_diffCo</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the ionization coefficient.</span>
<span class="cm">    @param[in] a_alpha Townsend ionization coefficient. E is the field in SI units. </span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setAlpha</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_alpha</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the attachment coefficient.</span>
<span class="cm">    @param[in] a_eta Townsend attachment coefficient. E is the field in SI units. </span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setEta</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_eta</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Get ionization coefficient</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span>
<span class="w">  </span><span class="n">getAlpha</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Get attachment coefficient</span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span>
<span class="w">  </span><span class="n">getEta</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the background ionization rate (e.g. from cosmic radiation etc). </span>
<span class="cm">    @param[in] a_backgroundRate Background ionization rate (units of 1/m^3 s). </span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setBackgroundRate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_backgroundRate</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the detachment rate for negative ions.</span>
<span class="cm">    @details The total detachment rate is dn_e/dt = k*n_ion; this sets the constant k. </span>
<span class="cm">    @param[in] a_detachmentRate Detachment rate (in units of 1/s). </span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setDetachmentRate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_detachmentRate</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the field emission current</span>
<span class="cm">    @param[in] a_fieldEmission Field emission current density. </span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setFieldEmission</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_currentDensity</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">    @brief Set the secondary emission coefficient</span>
<span class="cm">    @param[in] a_coeff Secondary emission coefficient. </span>
<span class="cm">  */</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span>
<span class="w">  </span><span class="nf">setSecondaryEmission</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">&amp;</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RealVect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a_coeff</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is relatively simple to use tabulated data input for setting the input (e.g., the transport coefficients).
See <a class="reference internal" href="../Utilities/LookupTable.html#chap-lookuptable"><span class="std std-ref">LookupTable1D</span></a>.</p>
</div>
</section>
<section id="algorithms">
<h2>Algorithms<a class="headerlink" href="#algorithms" title="Permalink to this heading"></a></h2>
<p>The discharge inception model uses a combination of electrostatic field solves, Particle-In-Cell, and fluid advection for resolving the necessary dynamics.
The various algorithms involved are discussed below.</p>
<section id="field-solve">
<h3>Field solve<a class="headerlink" href="#field-solve" title="Permalink to this heading"></a></h3>
<p>Since the background field scales linearly with applied voltage, we require only a single field solve at the beginning of the simulation.
This field solve is done with an applied voltage of <span class="math notranslate nohighlight">\(U = 1\,\text{V}\)</span> and the electric field is then later scaled by the appropriate voltage.</p>
</section>
<section id="inception-integral">
<h3>Inception integral<a class="headerlink" href="#inception-integral" title="Permalink to this heading"></a></h3>
<p>We use a Particle-In-Cell method for computing the inception integral <span class="math notranslate nohighlight">\(K\left(\mathbf{x}\right)\)</span> for an arbitrary electron starting position.
All grid cells where <span class="math notranslate nohighlight">\(\alpha_{\textrm{eff}} &gt; 0\)</span> are seeded with one particle on the cell centroid and the particles are then tracked through the grid.
The particles move a user-specified distance along field lines <span class="math notranslate nohighlight">\(\mathbf{E}\)</span>,  using first or second order integration.
If a particle leaves through a boundary (EB or domain boundary), or enters a region <span class="math notranslate nohighlight">\(\alpha_{\text{eff}} \leq 0\)</span>, the integration for that particle is stopped.
Once all the particle integrations have halted, we rewind the particles back to their starting position and deposit their weight on the mesh, which provides us with <span class="math notranslate nohighlight">\(K = K\left(\mathbf{x}\right)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When tracking positive ions for evaluation of the Townsend criterion, the same algorithms are used.</p>
</div>
<section id="euler">
<h4>Euler<a class="headerlink" href="#euler" title="Permalink to this heading"></a></h4>
<p>For the Euler rule the particle weight for a particle <span class="math notranslate nohighlight">\(p\)</span> the update rule is</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\mathbf{X}_p^{k+1} = \mathbf{X}_p^k - \mathbf{\hat{E}}\left(\mathbf{X}_p^k\right)\Delta x\\w_p^{k+1} = w_p^k + \alpha_{\text{eff}}\left(\left|\mathbf{E}\left(\mathbf{X}_p^k\right)\right|,\mathbf{X}_p^k\right)\Delta x,\end{aligned}\end{align} \]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta x\)</span> is an integration length.</p>
</section>
<section id="trapezoidal">
<h4>Trapezoidal<a class="headerlink" href="#trapezoidal" title="Permalink to this heading"></a></h4>
<p>With the trapezoidal rule we first update</p>
<div class="math notranslate nohighlight">
\[\mathbf{X}_p^\prime = \mathbf{X}_p^k - \mathbf{\hat{E}}\left(\mathbf{X}_p^k\right)\Delta x,\]</div>
<p>which is followed by</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\mathbf{X}_p^{k+1} = \mathbf{X}_p^k + \frac{\Delta x}{2}\left[\mathbf{\hat{E}}\left(\mathbf{X}_p^k\right) + \mathbf{\hat{E}}\left(\mathbf{X}_p^\prime\right)\right].\\w_p^{k+1} = w_p^k + \frac{\Delta x}{2}\left[\alpha_{\text{eff}}\left(\left|\mathbf{E}\left(\mathbf{X}_p^k\right)\right|,\mathbf{X}_p^k\right) + \alpha_{\text{eff}}\left(\left|\mathbf{E}\left(\mathbf{X}_p^\prime\right)\right|,\mathbf{X}_p^\prime\right)\right]\end{aligned}\end{align} \]</div>
</section>
<section id="step-size-selection">
<span id="chap-dischargeinceptionstepsizeselection"></span><h4>Step size selection<a class="headerlink" href="#step-size-selection" title="Permalink to this heading"></a></h4>
<p>The permitted tracer particle step size is controlled by user-specified maximum and minimum space steps:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;\Delta_{\textrm{phys,min}}: \textrm{Minimum physical step size}  \\
&amp;\Delta_{\textrm{phys,max}}: \textrm{Maximum physical step size}  \\
&amp;\Delta_{\textrm{grid,min}}: \textrm{Minimum grid-cell step size}  \\
&amp;\Delta_{\textrm{grid,max}}: \textrm{Maximum grid-cell step size}  \\
&amp;\Delta_{\alpha}:            \textrm{Avalanche length}  \\
&amp;\Delta_{\nabla\alpha}:      \textrm{Rate-of-change of ionization coefficient}.\end{split}\]</div>
<p>The particle integration step size is then selected according to the following heuristic:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\Delta X &amp;= \min\left(\Delta_\alpha\frac{1}{\overline{\alpha}}, \Delta_{\nabla\alpha}\frac{\overline{\alpha}}{\left|\nabla\overline{\alpha}\right|}\right) \\
\Delta X &amp;= \min\left(\Delta X, \Delta_{\textrm{phys,max}}\right) \\
\Delta X &amp;= \max\left(\Delta X, \Delta_{\textrm{phys,min}}\right) \\
\Delta X &amp;= \min\left(\Delta X, \Delta_{\textrm{grid,max}}\Delta x\right) \\
\Delta X &amp;= \max\left(\Delta X, \Delta_{\textrm{grid,min}}\Delta x\right).\end{split}\]</div>
<p>These parameters are implemented through the following input options:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Particle integration controls
DischargeInceptionStepper.min_phys_dx      = 1.E-10          ## Minimum permitted physical step size
DischargeInceptionStepper.max_phys_dx      = 1.E99           ## Maximum permitted physical step size
DischargeInceptionStepper.min_grid_dx      = 0.5             ## Minimum permitted grid step size
DischargeInceptionStepper.max_grid_dx      = 5.0             ## Maximum permitted grid step size
DischargeInceptionStepper.alpha_dx         = 5.0             ## Step size relative to avalanche length
DischargeInceptionStepper.grad_alpha_dx    = 0.1             ## Maximum step size relative to alpha/grad(alpha)
DischargeInceptionStepper.townsend_grid_dx = 2.0             ## Space step to use for Townsend tracking
</pre></div>
</div>
<p>Note that the input variable <code class="docutils literal notranslate"><span class="pre">townsend_grid_dx</span></code> determines the spatial step (relative to the grid resolution <span class="math notranslate nohighlight">\(\Delta x\)</span>) when tracking ions for the Townsend region reconstruction.</p>
</section>
</section>
<section id="critical-volume">
<h3>Critical volume<a class="headerlink" href="#critical-volume" title="Permalink to this heading"></a></h3>
<p>The critical volume is computed as</p>
<div class="math notranslate nohighlight">
\[V_c = \int_{K\left(\mathbf{x}\right) \geq K_c \cup \gamma\exp\left[K\left(\mathbf{x}\right)\right] \ge 1} \text{d}V.\]</div>
<p>Note that the critical volume is both voltage and polarity dependent.</p>
</section>
<section id="critical-surface">
<h3>Critical surface<a class="headerlink" href="#critical-surface" title="Permalink to this heading"></a></h3>
<p>The critical surface is computed as</p>
<div class="math notranslate nohighlight">
\[A_c = \int_{K\left(\mathbf{x}\right) \geq K_c \cup \gamma\left(\exp\left[K\left(\mathbf{x}\right)\right]-1\right) \ge 1} \text{d}A.\]</div>
<p>Note that the critical surface is both voltage and polarity dependent, and is non-zero only on cathode surfaces.</p>
</section>
<section id="inception-voltage">
<h3>Inception voltage<a class="headerlink" href="#inception-voltage" title="Permalink to this heading"></a></h3>
<p>The inception voltage for starting a critical avalanche can be computed in the stationary solver mode (see <a class="reference internal" href="#chap-stationarymode"><span class="std std-ref">Stationary mode</span></a>).
This is done separately for the streamer and Townsend inception voltages.</p>
<section id="streamer-inception">
<h4>Streamer inception<a class="headerlink" href="#streamer-inception" title="Permalink to this heading"></a></h4>
<p>For streamer inception we use <span class="math notranslate nohighlight">\(K\left(\mathbf{x}; U\right)\)</span> for a range of voltages <span class="math notranslate nohighlight">\(U \in U_1, U_2, \ldots\)</span> and (linearly) interpolate between these values.
If two values of the <span class="math notranslate nohighlight">\(K\)</span> integral bracket <span class="math notranslate nohighlight">\(K_c\)</span>, i.e.</p>
<div class="math notranslate nohighlight">
\[\begin{split}K_a &amp;= K\left(\mathbf{x}; U_a\right) \leq K_c \\
K_b &amp;= K\left(\mathbf{x}; U_b\right) \geq K_c\end{split}\]</div>
<p>then we can estimate the inception voltage for a starting electron at position <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> through linear interpolation as</p>
<div class="math notranslate nohighlight">
\[U_{\text{inc, streamer}}\left(\mathbf{x}\right) = U_a + \frac{K_c - K_a}{K_b - K_a}\left(U_b - U_a\right)\]</div>
</section>
<section id="townsend-inception">
<h4>Townsend inception<a class="headerlink" href="#townsend-inception" title="Permalink to this heading"></a></h4>
<p>A similar method to the one used above is used for the Townsend criterion, using e.g. <span class="math notranslate nohighlight">\(T\left(\mathbf{x}; U\right) = \gamma\left(\exp\left[K\left(\mathbf{x}; U\right)\right]-1\right)\)</span>, then if</p>
<div class="math notranslate nohighlight">
\[\begin{split}T_a &amp;= T\left(\mathbf{x}; U_a\right) \leq 1, \\
T_b &amp;= T\left(\mathbf{x}; U_b\right) \ge 1,\end{split}\]</div>
<p>then we can estimate the inception voltage for a starting electron at position <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> through linear interpolation as</p>
<div class="math notranslate nohighlight">
\[U_{\text{inc, Townsend}}\left(\mathbf{x}\right) = U_a + \frac{1 - T_a}{T_b - T_a}\left(U_b - U_a\right)\]</div>
</section>
<section id="minimum-inception-voltage">
<h4>Minimum inception voltage<a class="headerlink" href="#minimum-inception-voltage" title="Permalink to this heading"></a></h4>
<p>The minium inception voltage is the minimum voltage required for starting a critical avalanche (or Townsend process) for an arbitrary starting electron.
For any position <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>, then</p>
<div class="math notranslate nohighlight">
\[U_{\text{inc}}\left(\mathbf{x}\right) = \min\left[U_{\text{inc, streamer}}\left(\mathbf{x}\right), U_{\text{inc, Townsend}}\left(\mathbf{x}\right)\right]\]</div>
<p>From the above, this is simply</p>
<div class="math notranslate nohighlight">
\[U_{\text{inc}}^{\text{min}} = \min_{\forall \mathbf{x}} \left[U_{\text{inc}}\left(\mathbf{x}\right)\right].\]</div>
<p>From the above we also determine</p>
<div class="math notranslate nohighlight">
\[\mathbf{x}_{\text{inc}}^{\text{min}} \leftarrow \mathbf{x}\text{ that minimizes } U_{\text{inc}}\left(\mathbf{x}\right) \forall \mathbf{x},\]</div>
<p>which is the position of the first electron that enables a critical avalanche at the minimum inception voltage.</p>
</section>
</section>
<section id="id1">
<h3>Inception probability<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>The inception probability is given by <a class="reference internal" href="#equation-dischargeinceptionprobability">Eq. 15</a> and is computed using straightforward numerical quadrature:</p>
<div class="math notranslate nohighlight">
\[\int_{V_c}\left\langle\frac{dn_{\text{e}}}{dt}\right\rangle\left(1-\frac{\eta}{\alpha}\right) \text{d}V \approx \sum_{\mathbf{i}\in K_\mathbf{i} &gt; K_c} \left(\left\langle\frac{dn_{\text{e}}}{dt}\right\rangle\right)_{\mathbf{i}}\left(1 - \frac{\eta_{\mathbf{i}}}{\alpha_{\mathbf{i}}}\right)\kappa_{\mathbf{i}}\Delta V_{\mathbf{i}},\]</div>
<p>and similarly for the surface integral.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The integration runs over <em>valid cells</em>, i.e. grid cells that are not covered by a finer grid.</p>
</div>
</section>
<section id="advection-algorithm">
<h3>Advection algorithm<a class="headerlink" href="#advection-algorithm" title="Permalink to this heading"></a></h3>
<p>The advection algorithm for the negative ion distribution follows the time stepping algorithms described in the advection-diffusion model, see <a class="reference internal" href="AdvectionDiffusionModel.html#chap-advectiondiffusionmodel"><span class="std std-ref">Advection-diffusion model</span></a>.</p>
</section>
</section>
<section id="adaptive-mesh-refinement">
<h2>Adaptive mesh refinement<a class="headerlink" href="#adaptive-mesh-refinement" title="Permalink to this heading"></a></h2>
<p>The discharge inception model runs its own mesh refinement routine, which refines the mesh if</p>
<div class="math notranslate nohighlight">
\[\alpha_{\text{eff}}\left(\left|\mathbf{E}\right|, \mathbf{x}\right)\Delta x &gt; \lambda,\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda\)</span> is a user-specified refinement criterion.
The user can control refinement buffers and criterion through the following input options (see <a class="reference internal" href="#chap-dischargeinceptionconfiguration"><span class="std std-ref">Solver configuration</span></a>).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DischargeInceptionTagger.buffer</span></code> Adds a buffer region around tagged cells.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DischargeInceptionTagger.max_voltage</span></code> Maximum voltage that will be simulated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DischargeInceptionTagger.ref_alpha</span></code> Sets the refinement criterion <span class="math notranslate nohighlight">\(\lambda\)</span> as above.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When using transient mode, it may be useful to simply set the maximum voltage to the peak voltage of the voltage curve.</p>
<p>For stationary solves it might be difficult because the range of voltages is determined automatically during run-time.
It may be beneficial to run the program twice, first using <code class="docutils literal notranslate"><span class="pre">max_voltage</span> <span class="pre">=</span> <span class="pre">1</span></code>, and then running the program again using the peak voltage from the output file.</p>
</div>
</section>
<section id="solver-configuration">
<span id="chap-dischargeinceptionconfiguration"></span><h2>Solver configuration<a class="headerlink" href="#solver-configuration" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">DischargeInceptionStepper</span></code> class come with user-configurable input options which are given below.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># ====================================================================================================
# DischargeInceptionStepper class options
# ====================================================================================================
DischargeInceptionStepper.verbosity            = -1                ## Chattiness.
DischargeInceptionStepper.profile              = false             ## Turn on/off run-time profiling
DischargeInceptionStepper.full_integration     = true              ## Use full reconstruction of K-region or not
DischargeInceptionStepper.mode                 = stationary        ## Mode (stationary or transient)
DischargeInceptionStepper.eval_townsend        = true              ## Evaluate Townsend criterion or not
DischargeInceptionStepper.inception_alg        = trapz             ## Integration algorithm. Either euler or trapz
DischargeInceptionStepper.output_file          = report.txt        ## Output file
DischargeInceptionStepper.K_inception          = 12                ## User-specified inception value
DischargeInceptionStepper.plt_vars             = K T Uinc field    ## Plot variables

# Particle integration controls
DischargeInceptionStepper.min_phys_dx          = 1.E-10    ## Minimum permitted physical step size
DischargeInceptionStepper.max_phys_dx          = 1.E99     ## Maximum permitted physical step size
DischargeInceptionStepper.min_grid_dx          = 0.5       ## Minimum permitted grid step size
DischargeInceptionStepper.max_grid_dx          = 5.0       ## Maximum permitted grid step size
DischargeInceptionStepper.alpha_dx             = 5.0       ## Step size relative to avalanche length
DischargeInceptionStepper.grad_alpha_dx        = 0.1       ## Maximum step size relative to alpha/grad(alpha)
DischargeInceptionStepper.townsend_grid_dx     = 2.0       ## Space step to use for Townsend tracking

# Static mode
DischargeInceptionStepper.rel_step_dU     = 0.05    ## Relative (%) voltage increase for each step
DischargeInceptionStepper.limit_max_K     = 15.0    ## Limit the maximum K-value

# Dynamic mode
DischargeInceptionStepper.ion_transport     = true     ## Turn on/off ion transport
DischargeInceptionStepper.transport_alg     = heun     ## Transport algorithm. &#39;euler&#39;, &#39;heun&#39;, or &#39;imex&#39;
DischargeInceptionStepper.cfl               = 0.8      ## CFL time step for dynamic mode
DischargeInceptionStepper.first_dt          = 1.E-9    ## First time step to be used.
DischargeInceptionStepper.min_dt            = 1.E-9    ## Minimum permitted time step
DischargeInceptionStepper.max_dt            = 1.E99    ## Maximum permitted time step
DischargeInceptionStepper.voltage_eps       = 0.02     ## Permitted relative change in V(t) when computing dt
DischargeInceptionStepper.max_dt_growth     = 0.05     ## Maximum relative change in dt when computing dt
</pre></div>
</div>
<p>In the above options, the user can select the integration algorithms, the mode, and where to place the output file (which contains, e.g., the values of the ionization integral).
The user can also include the following data in the HDF5 output files, by setting the <code class="docutils literal notranslate"><span class="pre">plt_vars</span></code> configuration option:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">field</span></code>    - Potential, field, and charge distributions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">K</span></code>        - Inception integral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>        - Townsend criterion.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Uinc</span></code>     - Inception voltage.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code>    - Effective ionization coefficient.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eta</span></code>      - Eta coefficient.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bg_rate</span></code>  - Background ionization rate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emission</span></code> - Field emission.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">poisson</span></code>  - Poisson solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tracer</span></code>   - Tracer particle solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cdr</span></code>      - CDR solver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ions</span></code>     - Ion solver.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The interface for setting the transport data (e.g., ionization coefficients) occurs via the C++ interface.</p>
</div>
</section>
<section id="setting-up-a-new-problem">
<span id="chap-dischargeinceptionsetup"></span><h2>Setting up a new problem<a class="headerlink" href="#setting-up-a-new-problem" title="Permalink to this heading"></a></h2>
<p>To set up a new problem, using the Python setup tools in <code class="file docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Physics/DischargeInception</span></code> is the simplest way.
A full description is available in the <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file contained in the folder:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gh"># Physics/DischargeInception</span>
This physics module predicts discharge inception. 
The user must supply transport coefficients, geometry, and electron sources. 

<span class="gu">## Setting up a new application</span>
To set up a new problem, use the Python script. For example:

<span class="sb">```shell</span>
python3<span class="w"> </span>setup.py<span class="w"> </span>-base_dir<span class="o">=</span>MyApplications<span class="w"> </span>-app_name<span class="o">=</span>MyDischargeInception<span class="w"> </span>-geometry<span class="o">=</span>Cylinder
<span class="sb">```</span>

The application will then be installed to $DISCHARGE_HOME/MyApplications/MyDischargeInception.
</pre></div>
</div>
<p>To see available setup options, use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./setup.py<span class="w"> </span>--help
</pre></div>
</div>
</section>
<section id="example-programs">
<h2>Example programs<a class="headerlink" href="#example-programs" title="Permalink to this heading"></a></h2>
<p>Example programs that use the discharge inception model are given in</p>
<section id="high-voltage-vessel">
<h3>High-voltage vessel<a class="headerlink" href="#high-voltage-vessel" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Exec/Examples/DischargeInception/Vessel</span></code>.
This program is set up in 2D (stationary) and 3D (transient) for discharge inception in atmospheric air.
The input data is computed using BOLSIG+.</p></li>
</ul>
</section>
<section id="electrode-with-surface-roughness">
<h3>Electrode with surface roughness<a class="headerlink" href="#electrode-with-surface-roughness" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Exec/Examples/DischargeInception/ElectrodeRoughness</span></code>.
This program is set up in 2D (stationary) and 3D (transient) for discharge inception on an irregular electrode surface.
We use SF6 transport data as input data, computed using BOLSIG+.</p></li>
</ul>
</section>
<section id="id2">
<h3>Electrode with surface roughness<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Exec/Examples/DischargeInception/ElectrodeRoughness</span></code>.
This program is set up in 2D and 3D (stationary) mode, and includes the influence of the Townsend criterion.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CdrPlasmaModel.html" class="btn btn-neutral float-left" title="CDR plasma model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ItoKMC.html" class="btn btn-neutral float-right" title="Îto-KMC plasma model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SINTEF Energy Research.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>