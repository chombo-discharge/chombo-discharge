<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; chombo-discharge  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization" href="Visualization.html" />
    <link rel="prev" title="Overview" href="Overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> chombo-discharge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Documentation.html">Using this documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-chombo-discharge">Obtaining <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#organization">Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-chombo-discharge">Cloning <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-environment">Setting up the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-build">Test build</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-configuration">Advanced configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#main-settings">Main settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hdf5">HDF5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiler-flags">Compiler flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-defined-configuration-files">Pre-defined configuration files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gnu-configuration-for-workstations">GNU configuration for workstations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-on-clusters">Configuration on clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-an-example-application">Running an example application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recommended-configurations">Recommended configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#production-runs">Production runs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-problems">Common problems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Control.html">Controlling <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="Testing.html">Code testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Acknowledgements.html">Acknowledgements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Source/DesignOverview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Driver.html">Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/ComputationalGeometry.html">ComputationalGeometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/TimeStepper.html">TimeStepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/AmrMesh.html">AmrMesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/CellTagger.html">CellTagger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/GeoCoarsener.html">GeoCoarsener</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Discretization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Source/SpatialDiscretization.html">Spatial discretization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/ChomboBasics.html"><code class="docutils literal notranslate"><span class="pre">Chombo-3</span></code> basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/MeshData.html">Mesh data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Particles.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Realm.html">Realm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/Regridding.html">Regridding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/LinearSolvers.html">Linear solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Source/VV.html">Verification and validation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Solvers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/CDR.html">Convection-Diffusion-Reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/Electrostatics.html">Electrostatic solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/MeshODESolver.html">Mesh ODE solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/RTE.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/SurfaceODESolver.html">Surface ODE solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/TracerParticles.html">Tracer particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Solvers/Ito.html">Îto diffusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multi-physics applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Applications/CdrPlasmaModel.html">CDR plasma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/StreamerInceptionModel.html">Streamer inception model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Single-solver applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Applications/AdvectionDiffusionModel.html">Advection-diffusion model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/BrownianWalkerModel.html">Brownian walker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/ElectrostaticsModel.html">Electrostatics model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/GeometryModel.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/MeshODEModel.html">Mesh ODE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/RadiativeTransferModel.html">Radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Applications/TracerParticleModel.html">Tracer particle model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/Tutorial.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/Tutorial.html#creating-a-geometry">Creating a geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/Tutorial.html#setting-up-a-timestepper">Setting up a <code class="docutils literal notranslate"><span class="pre">TimeStepper</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/LookupTable.html">Lookup tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/RandomNumbers.html">Random numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/LeastSquares.html">Least squares</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Contrib/Contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contrib/CodeStandard.html">Code standard</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ZZReferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">chombo-discharge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Base/Installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="installation">
<span id="chap-installation"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h1>
<div class="section" id="obtaining-chombo-discharge">
<h2>Obtaining <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code><a class="headerlink" href="#obtaining-chombo-discharge" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> can be freely obtained from <a class="reference external" href="https://github.com/chombo-discharge/chombo-discharge">https://github.com/chombo-discharge/chombo-discharge</a>.
The following packages are <em>required</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Chombo</span></code>, which is supplied with <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>.</p></li>
<li><p>The C++ JSON file parser <a class="reference external" href="https://github.com/nlohmann/json">https://github.com/nlohmann/json</a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">EBGeometry</span></code> package, see <a class="reference external" href="https://github.com/rmrsk/EBGeometry">https://github.com/rmrsk/EBGeometry</a>.</p></li>
<li><p>LAPACK and BLAS</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Chombo</span></code>, <code class="docutils literal notranslate"><span class="pre">nlohmann/json</span></code>, and <code class="docutils literal notranslate"><span class="pre">EBGeometry</span></code> dependencies are automatically handled by <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> through git submodules.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Our version of <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> is hosted at <a class="reference external" href="https://github.com/chombo-discharge/Chombo-3.3.git">https://github.com/chombo-discharge/Chombo-3.3.git</a>.
<code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> has made substantial changes to the embedded boundary generation in <code class="docutils literal notranslate"><span class="pre">Chombo</span></code>.
It will not compile with other versions of <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> than the one above.</p>
</div>
<p>Optional packages are</p>
<ul class="simple">
<li><p>A serial or parallel version of HDF5, which is used for writing plot and checkpoint files.</p></li>
<li><p>An MPI installation, which is used for parallelization.</p></li>
<li><p><a class="reference external" href="https://visit-dav.github.io/visit-website/">https://visit-dav.github.io/visit-website/</a> visualization, which used for visualization.</p></li>
</ul>
</div>
<div class="section" id="organization">
<h2>Organization<a class="headerlink" href="#organization" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> source files are organized as follows:</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Code organization.</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Folder</p></th>
<th class="head"><p>Explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="file docutils literal notranslate"><span class="pre">Source</span></code></p></td>
<td><p>Source files for the AMR core, solvers, and various utilities.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="file docutils literal notranslate"><span class="pre">Physics</span></code></p></td>
<td><p>Various implementations that can run the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> source code.</p></td>
</tr>
<tr class="row-even"><td><p><code class="file docutils literal notranslate"><span class="pre">Geometries</span></code></p></td>
<td><p>Various geometries.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="file docutils literal notranslate"><span class="pre">Submodules</span></code></p></td>
<td><p>Git submodule dependencies.</p></td>
</tr>
<tr class="row-even"><td><p><code class="file docutils literal notranslate"><span class="pre">Exec</span></code></p></td>
<td><p>Various executable applications.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cloning-chombo-discharge">
<h2>Cloning <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code><a class="headerlink" href="#cloning-chombo-discharge" title="Permalink to this heading"></a></h2>
<p>To obtain <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>, the simplest approach is to clone it and recursively fetch the submodules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recursive git@github.com:chombo-discharge/chombo-discharge.git
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-environment">
<h2>Setting up the environment<a class="headerlink" href="#setting-up-the-environment" title="Permalink to this heading"></a></h2>
<p>When compiling <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>, makefiles must be able to find both <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> and <code class="docutils literal notranslate"><span class="pre">Chombo</span></code>.
In our makefiles the paths to these are supplied through the environment variables</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DISCHARGE_HOME</span></code>, pointing to the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> root directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHOMBO_HOME</span></code>, pointing to your <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> library</p></li>
</ul>
<p>Note that <code class="docutils literal notranslate"><span class="pre">DISCHARGE_HOME</span></code> must point to the root folder in the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> source code, while <code class="docutils literal notranslate"><span class="pre">CHOMBO_HOME</span></code> must point to the <code class="file docutils literal notranslate"><span class="pre">lib/</span></code> folder in your <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> root directory.
When cloning with submodules, both <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> and <code class="docutils literal notranslate"><span class="pre">nlohmann/json</span></code> will be placed in the <code class="file docutils literal notranslate"><span class="pre">Submodules</span></code> folder in <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To clone <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> directly to <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME</span></code>, set the environment variables and clone (using <code class="docutils literal notranslate"><span class="pre">--recursive</span></code> to fetch submodules):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DISCHARGE_HOME</span><span class="o">=</span>/home/foo/chombo-discharge
<span class="nb">export</span> <span class="nv">CHOMBO_HOME</span><span class="o">=</span><span class="nv">$DISCHARGE_HOME</span>/Submodules/Chombo-3.3/lib

git clone --recursive git@github.com:chombo-discharge/chombo-discharge.git <span class="si">${</span><span class="nv">DISCHARGE_HOME</span><span class="si">}</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> is built using a configuration file supplied to <code class="docutils literal notranslate"><span class="pre">Chombo</span></code>.
This file must reside in <code class="docutils literal notranslate"><span class="pre">$CHOMBO_HOME/mk</span></code>.
Some standard configuration files are supplied with <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>, and reside in <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Lib/Local</span></code>.
These files may or may not work right off the bat.</p>
</div>
<div class="section" id="test-build">
<h2>Test build<a class="headerlink" href="#test-build" title="Permalink to this heading"></a></h2>
<p>For a quick compilation test the user can use the GNU configuration file supplied with <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> by following the steps below.</p>
<ol class="arabic">
<li><p>Copy the GNU configuration file</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp $DISCHARGE_HOME/Lib/Local/Make.defs.GNU $CHOMBO_HOME/mk/Make.defs.local
</pre></div>
</div>
</li>
<li><p>If you do not have the GNU compiler suite, install it by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">csh</span> <span class="n">gfortran</span> <span class="n">g</span><span class="o">++</span> <span class="n">libblas</span><span class="o">-</span><span class="n">dev</span> <span class="n">liblapack</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>This will install</p>
<blockquote>
<div><ul class="simple">
<li><p>LAPACK and BLAS</p></li>
<li><p>GNU compilers for Fortran and C++</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Compile <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cd $DISCHARGE_HOME
make -s -j4
</pre></div>
</div>
</li>
</ol>
<p>This will compile the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> source code in serial and without HDF5 (using four cores for the compilation).
If successful, <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> libraries will appear in <code class="docutils literal notranslate"><span class="pre">$DISCARGE_HOME/Lib</span></code>.</p>
</div>
<div class="section" id="advanced-configuration">
<span id="chap-advancedconfig"></span><h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> is compiled using GNU Make, following the <code class="docutils literal notranslate"><span class="pre">Chombo</span></code>.
Compilers, libraries, and configuration options are defined in a file <code class="docutils literal notranslate"><span class="pre">Make.defs.local</span></code> which resides in <code class="docutils literal notranslate"><span class="pre">$CHOMBO_HOME/mk</span></code>.
Users need to supply this file in order to compile <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>.
Typically, these steps include</p>
<ul class="simple">
<li><p>Specifying Fortran and C++ compilers</p></li>
<li><p>Specifying configurations. E.g., serial or parallel builds, and compiler flags.</p></li>
<li><p>Specifying library paths (in particular for HDF5).</p></li>
</ul>
<div class="section" id="main-settings">
<h3>Main settings<a class="headerlink" href="#main-settings" title="Permalink to this heading"></a></h3>
<p>The main variables that the user needs to set are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DIM</span> <span class="pre">=</span> <span class="pre">2/3</span></code> The dimensionality (must be 2 or 3).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DEBUG</span> <span class="pre">=</span> <span class="pre">TRUE/FALSE</span></code>
This enables or disables debugging flags and code checks/assertions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OPT</span> <span class="pre">=</span> <span class="pre">FALSE/TRUE/HIGH</span></code>.
Setting <code class="docutils literal notranslate"><span class="pre">OPT=TRUE/HIGH</span></code> enables optimization flags that will speed up <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> and <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PRECISION</span> <span class="pre">=</span> <span class="pre">DOUBLE</span></code>
Currently, <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> has not been wetted with single precision.
Many algorithms (like conjugate gradient) depend on the use of double precision.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CXX</span> <span class="pre">=</span> <span class="pre">&lt;C++</span> <span class="pre">compiler&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FC</span> <span class="pre">=</span> <span class="pre">&lt;Fortran</span> <span class="pre">compiler&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI</span> <span class="pre">=</span> <span class="pre">TRUE/FALSE</span></code>
This enables/disables MPI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPICXX</span> <span class="pre">=</span> <span class="pre">&lt;MPI</span> <span class="pre">compiler&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CXXSTD=14</span></code>
Sets the C++ standard - we are currently at C++14.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_EB=TRUE</span></code>
Configures <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> with embedded boundary functionality.
This is a requirement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_MF=TRUE</span></code>
Configures <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> with multifluid functionality.
This is a requirement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_HDF5</span> <span class="pre">=</span> <span class="pre">TRUE/FALSE</span></code>
This enables and disables HDF5 code.</p></li>
</ul>
</div>
<div class="section" id="hdf5">
<h3>HDF5<a class="headerlink" href="#hdf5" title="Permalink to this heading"></a></h3>
<p>If using HDF5, one must also set the following flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HDFINCFLAGS</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">=</span> <span class="pre">-I&lt;path</span> <span class="pre">to</span> <span class="pre">hdf5-serial&gt;/include</span></code> (for serial HDF5).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HDFLIBFLAGS</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">=</span> <span class="pre">-L&lt;path</span> <span class="pre">to</span> <span class="pre">hdf5-serial&gt;/lib</span> <span class="pre">-lhdf5</span> <span class="pre">-lz</span></code> (for serial HDF5)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HDFMPIINCFLAGS</span>&#160;&#160; <span class="pre">=</span> <span class="pre">-I&lt;path</span> <span class="pre">to</span> <span class="pre">hdf5-parallel&gt;/include</span></code> (for parallel HDF5)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HDFMPILIBFLAGS</span>&#160;&#160; <span class="pre">=</span> <span class="pre">-L&lt;path</span> <span class="pre">to</span> <span class="pre">hdf5-parallel&gt;/lib</span> <span class="pre">-lhdf5</span> <span class="pre">-lz</span></code> (for parallel HDF5).</p></li>
</ul>
</div>
<div class="section" id="compiler-flags">
<h3>Compiler flags<a class="headerlink" href="#compiler-flags" title="Permalink to this heading"></a></h3>
<p>Compiler flags are set through</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cxxoptflags</span>&#160; <span class="pre">=</span> <span class="pre">&lt;C++</span> <span class="pre">compiler</span> <span class="pre">flags</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">foptflags</span>&#160;&#160;&#160; <span class="pre">=</span> <span class="pre">&lt;Fortran</span> <span class="pre">compiler</span> <span class="pre">flags</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">syslibflags</span>&#160; <span class="pre">=</span> <span class="pre">&lt;system</span> <span class="pre">library</span> <span class="pre">flags&gt;</span></code></p></li>
</ul>
<p>Note that LAPACK and BLAS are requirements in <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>.
Linking to these can often be done using</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">syslibflag</span> <span class="pre">=</span> <span class="pre">-llapack</span> <span class="pre">-lblas</span></code> (for GNU compilers)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">syslibflag</span> <span class="pre">=</span> <span class="pre">-mkl=sequential</span></code> (for Intel compilers)</p></li>
</ul>
</div>
<div class="section" id="pre-defined-configuration-files">
<h3>Pre-defined configuration files<a class="headerlink" href="#pre-defined-configuration-files" title="Permalink to this heading"></a></h3>
<p>Some commonly used configuration files are found in <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Lib/Local</span></code>.
<code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> can be compiled in serial or with MPI, and with or without HDF5.
The user need to configure the <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> makefile to ensure that the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> is properly configured.
Below, we include brief instructions for compilation on a Linux workstation and for a cluster.</p>
</div>
<div class="section" id="gnu-configuration-for-workstations">
<h3>GNU configuration for workstations<a class="headerlink" href="#gnu-configuration-for-workstations" title="Permalink to this heading"></a></h3>
<p>Here, we provide a more complete installation example using GNU compilers for a workstation.
These steps are intended for users that do not have MPI or HDF5 installed.
If you already have installed MPI and/or HDF5, the steps below might require modifications.</p>
<ol class="arabic">
<li><p>Ensure that <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME</span></code> and <code class="docutils literal notranslate"><span class="pre">$CHOMBO_HOME</span></code> point to the correct locations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="nv">$DISCHARGE_HOME</span>
<span class="nb">echo</span> <span class="nv">$CHOMBO_HOME</span>
</pre></div>
</div>
</li>
<li><p>Install GNU compiler dependencies by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">csh</span> <span class="n">gfortran</span> <span class="n">g</span><span class="o">++</span> <span class="n">libblas</span><span class="o">-</span><span class="n">dev</span> <span class="n">liblapack</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>This will install</p>
<blockquote>
<div><ul class="simple">
<li><p>LAPACK and BLAS</p></li>
<li><p>GNU compilers for Fortran and C++</p></li>
</ul>
</div></blockquote>
</li>
<li><p>To also install OpenMPI and HDF5:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">libhdf5</span><span class="o">-</span><span class="n">dev</span> <span class="n">libhdf5</span><span class="o">-</span><span class="n">openmpi</span><span class="o">-</span><span class="n">dev</span> <span class="n">openmpi</span><span class="o">-</span><span class="nb">bin</span>
</pre></div>
</div>
<p>This will install</p>
<blockquote>
<div><ul class="simple">
<li><p>OpenMPI</p></li>
<li><p>HDF5, both serial and parallel.</p></li>
</ul>
</div></blockquote>
<p>Both serial and parallel HDF5 will be installed, and these are <em>usually</em> found in folders</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/x86_64-linux-gnu/hdf5/serial/</span></code> for serial HDF5</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/x86_64-linux-gnu/hdf5/openmpi/</span></code> for parallel HDF5 (using OpenMPI).</p></li>
</ul>
</div></blockquote>
<p>Before proceeding further, the user need to locate the HDF5 libraries (if building with HDF5).</p>
</li>
<li><p>After installing the dependencies, copy the desired configuration file to <code class="docutils literal notranslate"><span class="pre">$CHOMBO_HOME/mk</span></code>:</p>
<ul>
<li><p><strong>Serial build without HDF5</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp $DISCHARGE_HOME/Lib/Local/Make.defs.GNU $CHOMBO_HOME/mk/Make.defs.local
</pre></div>
</div>
</li>
<li><p><strong>Serial build with HDF5</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp $DISCHARGE_HOME/Lib/Local/Make.defs.HDF5.GNU $CHOMBO_HOME/mk/Make.defs.local
</pre></div>
</div>
</li>
<li><p><strong>MPI build without HDF5</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp $DISCHARGE_HOME/Lib/Local/Make.defs.MPI.GNU $CHOMBO_HOME/mk/Make.defs.local
</pre></div>
</div>
</li>
<li><p><strong>MPI build with HDF5</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp $DISCHARGE_HOME/Lib/Local/Make.defs.MPI.HDF5.GNU $CHOMBO_HOME/mk/Make.defs.local
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Compile the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cd $DISCHARGE_HOME
make -s -j4 discharge-lib
</pre></div>
</div>
</li>
</ol>
<p>This will compile the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> source code using the configuration settings set by the user.
To compile <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> in 3D, do <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-s</span> <span class="pre">-j4</span> <span class="pre">DIM=3</span> <span class="pre">discharge-lib</span></code>.
If successful, <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> libraries will appear in <code class="docutils literal notranslate"><span class="pre">$DISCARGE_HOME/Lib</span></code>.</p>
</div>
<div class="section" id="configuration-on-clusters">
<h3>Configuration on clusters<a class="headerlink" href="#configuration-on-clusters" title="Permalink to this heading"></a></h3>
<p>To configure <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> for executation on a cluster, use one of the makefiles supplied in <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Lib/Local</span></code> if it exists for your computer.
Alternatively, copy <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Lib/Local/Make.defs.local.template</span></code> to <code class="docutils literal notranslate"><span class="pre">$CHOMBO_HOME/mk/Make.defs.local</span></code> and set the compilers, optimization flags, and paths to HDF5 library.</p>
<p>On clusters, MPI and HDF5 are usually already installed, but must usually be loaded (e.g. as modules) before compilation.</p>
</div>
</div>
<div class="section" id="running-an-example-application">
<h2>Running an example application<a class="headerlink" href="#running-an-example-application" title="Permalink to this heading"></a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>, applications are set up so that they use the <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> source code and one <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> physics module.
To run one of the applications that use a particular <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> physics module, we will run a simulation of a positive streamer (in air).</p>
<p>The application code is located in <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Exec/Examples/CdrPlasma/DeterministicAir</span></code> and it uses the convection-diffusion-reaction plasma module (located in <code class="docutils literal notranslate"><span class="pre">$DISCHARGE_HOME/Physics/CdrPlasma</span></code>).</p>
<p>First, compile the application by</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cd $DISCHARGE_HOME/Exec/Examples/CdrPlasma/DeterministicAir
make -s -j4 DIM=2 program
</pre></div>
</div>
<p>This will provide an executable named <code class="docutils literal notranslate"><span class="pre">program2d.&lt;bunch_of_options&gt;.ex</span></code>.
If one compiles for 3D, i.e. <code class="docutils literal notranslate"><span class="pre">DIM=3</span></code>, the executable will be named <code class="docutils literal notranslate"><span class="pre">program3d.&lt;bunch_of_options&gt;.ex</span></code>.</p>
<p>To run the application do:</p>
<p><strong>Serial build</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./program2d.&lt;bunch_of_options&gt;.ex positive2d.inputs
</pre></div>
</div>
<p><strong>Parallel build</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mpirun -np 8 program2d.&lt;bunch_of_options&gt;.ex positive2d.inputs
</pre></div>
</div>
<p>If the user also compiled with HDF5, plot files will appear in the subfolder <code class="docutils literal notranslate"><span class="pre">plt</span></code>.</p>
</div>
<div class="section" id="troubleshooting">
<span id="chap-troubleshooting"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h2>
<p>If the prerequisites are in place, compilation of <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> is usually straightforward.
However, due to dependencies on <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> and HDF5, compilation can sometimes be an issue.
Our experience is that if <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> compiles, so does <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>.</p>
<p>If experiencing issues, try cleaning <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code> by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$DISCHARGE_HOME</span>
make pristine
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not hesitate to contact us at <a class="reference external" href="https://github.com/chombo-discharge/chombo-discharge">GitHub</a> regarding installation issues.</p>
</div>
<div class="section" id="recommended-configurations">
<h3>Recommended configurations<a class="headerlink" href="#recommended-configurations" title="Permalink to this heading"></a></h3>
<div class="section" id="production-runs">
<h4>Production runs<a class="headerlink" href="#production-runs" title="Permalink to this heading"></a></h4>
<p>For production runs, we generally recommend that the user compiles with <code class="docutils literal notranslate"><span class="pre">DEBUG=FALSE</span></code> and <code class="docutils literal notranslate"><span class="pre">OPT=HIGH</span></code>.
These settings can be set directly in <code class="file docutils literal notranslate"><span class="pre">Make.defs.local</span></code>.
Alternatively, they can be included directly on the command line when compiling problems.</p>
</div>
<div class="section" id="debugging">
<h4>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading"></a></h4>
<p>If you believe that there might be a bug in the code, one can compile with <code class="docutils literal notranslate"><span class="pre">DEBUG=TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">OPT=TRUE</span></code>.
This will turn on some assertions throughout <code class="docutils literal notranslate"><span class="pre">Chombo</span></code> and <code class="docutils literal notranslate"><span class="pre">chombo-discharge</span></code>.</p>
</div>
</div>
<div class="section" id="common-problems">
<h3>Common problems<a class="headerlink" href="#common-problems" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Missing library paths:</p>
<blockquote>
<div><p>On some installations the linker can not find the HDF5 library.
To troubleshoot, make sure that the the environment variable <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> can find the HDF5 libraries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
<p>If the path is not included, it can be defined by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/&lt;path_to_hdf5_installation&gt;/lib
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Visualization.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SINTEF Energy Research.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>